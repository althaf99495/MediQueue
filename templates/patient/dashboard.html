{% extends "dashboard_base.html" %}

{% block dashboard_content %}
<div class="space-y-8">
    {% if queue_position %}
    <div class="overflow-hidden rounded-2xl bg-teal-600 text-white shadow-lg relative p-8">
        <h2 class="text-4xl font-bold text-center mb-4">Queue Position</h2>
        <div class="text-center">
            <div class="text-8xl font-bold">{{ queue_position.position }}</div>
            <p class="text-2xl mt-4">of {{ queue_position.total }} patients</p>
            <p class="mt-4">Estimated Wait: {{ estimated_wait }} mins</p>
            <p class="mt-2">Doctor: Dr. {{ doctor_name }}</p>
        </div>
        <div class="mt-8 text-center">
            <a href="{{ url_for('patient.leave_queue') }}"
                class="inline-flex items-center rounded-lg bg-white/20 px-6 py-3 text-white hover:bg-white/30">Leave
                Queue</a>
        </div>
    </div>
    {% else %}
    <div class="rounded-2xl bg-white p-12 text-center shadow-sm dark:bg-slate-900">
        <h3 class="text-xl font-bold">Not in any queue</h3>
        <p class="mt-4">Book an appointment to join the queue</p>
        <a href="{{ url_for('patient.book_appointment') }}"
            class="mt-6 inline-flex items-center rounded-lg bg-teal-600 px-6 py-3 text-white">Book Appointment</a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if queue_position %}
<script>
    setInterval(function () {
        fetch('/api/queue/status/{{ queue_position.id }}')
            .then(r => r.json())
            .then(data => {
                if (data.position) document.querySelector('.text-8xl').textContent = data.position;
            });
    }, 5000);
</script>
{% endif %}
{% endblock %}